import{r as x,n as l,M as L,L as P,o as S,O as E,S as R}from"./components-DZUDnrCX.js";var y=()=>({isLocalhost:/^localhost$|^127(\.[0-9]+){0,2}\.[0-9]+$|^\[::1?\]$/.test(location.hostname)||location.protocol==="file:",isHeadlessBrowser:!!(window.navigator.webdriver||"_phantom"in window&&window._phantom||"__nightmare"in window&&window.__nightmare||"Cypress"in window&&window.Cypress)}),d=()=>{try{if(typeof window>"u"||typeof document>"u")return!1;const o=typeof navigator<"u"?navigator.userAgent:"";return!/node|jsdom/i.test(o)}catch{return!1}},B=o=>{const t={};return["utm_campaign","utm_source","utm_medium","utm_term","utm_content"].forEach(e=>{const s=o.getAll(e);s.length===1?t[e]=s[0]:s.length>1&&(t[e]=s)}),t},b=o=>{if(!o)return;const t=o.split(";"),e={};for(const s of t){const n=s.split("=").map(a=>a.trim());n.length!==2||n[0]===""||n[1]===""||(e[n[0]]=n[1])}return Object.keys(e).length===0?void 0:e},A=o=>{if(o)return o;const e=[{value:document.body?.getAttribute("data-s-path"),name:"data-s-path"},{value:document.body?.getAttribute("data-s:path"),name:"data-s:path"},{value:document.querySelector('meta[name="stonks-path"]')?.getAttribute("content"),name:"meta[name='stonks-path']"}].filter(({value:s})=>s);return e.length>1&&console.warn("[onedollarstats] Multiple path sources found. Using priority order:",e.map(({name:s})=>s).join(" > ")),e[0]?.value??location.pathname},k=(o,t)=>{const e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${e}$`).test(o)},w=(o,t)=>!(t.excludePages.some(e=>k(o,e))||t.includePages.length&&!t.includePages.some(e=>k(o,e))),U={trackLocalhostAs:null,collectorUrl:"https://collector.onedollarstats.com/events",hashRouting:!1,autocollect:!0,excludePages:[],includePages:[]},j=class p{constructor(t={}){this.autocollectSetupDone=!1,this.lastPage=null,this.config={...U,...t},d()&&this.config.autocollect&&this.setupAutocollect()}static getInstance(t={}){return d()?(p.instance||(p.instance=new p(t)),p.instance):(console.warn("[onedollarstats] Running in non-browser environment. Returning no-op instance."),new p(t))}async sendWithBeaconOrFetch(t){navigator.sendBeacon?.(this.config.collectorUrl,t)||fetch(this.config.collectorUrl,{method:"POST",body:t,headers:{"Content-Type":"application/json"},keepalive:!0}).catch(e=>console.error("[onedollarstats] fetch() failed:",e.message))}async send(t){const{isLocalhost:e,isHeadlessBrowser:s}=y();if(e&&!this.config.trackLocalhostAs||s)return;const n=new URL(location.href);let a=!1;e&&this.config.trackLocalhostAs&&n.hostname!==this.config.trackLocalhostAs&&(a=!0,n.hostname=this.config.trackLocalhostAs),n.search="",t.path&&(n.pathname=t.path);const i=n.href.replace(/\/$/,"");let c=t.referrer;try{if(!c&&document.referrer&&document.referrer!=="null"){const h=new URL(document.referrer);h.hostname!==n.hostname&&(c=h.href)}}catch{}const f={u:i,e:[{t:t.type,h:this.config.hashRouting,r:c,p:t.props}]};t.utm&&Object.keys(t.utm).length>0&&(f.qs=t.utm),a&&(f.debug=!0);const r=JSON.stringify(f),u=btoa(r);if(u.length<=1500){const h=new Image(1,1);h.onerror=()=>this.sendWithBeaconOrFetch(r),h.src=`${this.config.collectorUrl}?data=${u}`}else await this.sendWithBeaconOrFetch(r)}trackPageView({path:t,props:e},s=!1){if(!d())return;const n=A(t),a=e||(()=>{const c={},f=document.querySelectorAll("[data-s\\:view-props], [data-s-view-props]");for(const r of Array.from(f)){const u=r.getAttribute("data-s-view-props")||r.getAttribute("data-s:view-props");if(!u)continue;const g=b(u);Object.assign(c,g)}return Object.keys(c).length?c:void 0})();if(!this.config.hashRouting&&this.lastPage===n||s&&!w(n,this.config))return;this.lastPage=n;const i=B(new URLSearchParams(location.search));this.send({type:"PageView",path:n,props:a,utm:i})}async event(t,e,s){if(!d())return;const{isLocalhost:n,isHeadlessBrowser:a}=y();if(n&&!this.config.trackLocalhostAs||a)return;const i={};typeof e=="string"?(i.path=A(e),i.props=s):typeof e=="object"&&(i.props=e),this.send({type:t,...i})}async view(t,e){if(!d())return;const s={};typeof t=="string"?(s.path=t,s.props=e):typeof t=="object"&&(s.props=t),this.trackPageView(s)}setupAutocollect(){if(!d()||this.autocollectSetupDone)return;this.autocollectSetupDone=!0;const t=()=>this.trackPageView({},!0),e=()=>{document.visibilityState==="visible"&&t()};document.addEventListener("visibilitychange",e);const s=history.pushState.bind(history);history.pushState=(...a)=>{s(...a),requestAnimationFrame(()=>{t()})},window.addEventListener("popstate",t),window.addEventListener("hashchange",t);const n=a=>{const i=a;if(i.type==="auxclick"&&i.button!==1)return;const c=i.target;if(!c)return;const f=!!c.closest("a, button");let r=c,u=0;for(;r;){const g=r.getAttribute("data-s-event")||r.getAttribute("data-s:event");if(g){const m=r.getAttribute("data-s-event-props")||r.getAttribute("data-s:event-props"),h=m?b(m):void 0,v=r.getAttribute("data-s-event-path")||r.getAttribute("data-s:event-path")||void 0;if(v&&!w(v,this.config)||!w(location.pathname,this.config))return;this.event(g,v??h,h);return}if(r=r.parentElement,u++,!f&&u>=3)break}};document.addEventListener("click",n),document.visibilityState==="visible"&&t()}};j.instance=null;var $=j,T=(o={})=>{$.getInstance(o)};function _(){return x.useEffect(()=>{T({trackLocalhostAs:"example.com"}),console.log(22)},[]),l.jsxs("html",{children:[l.jsxs("head",{children:[l.jsx("link",{rel:"icon",href:"data:image/x-icon;base64,AA"}),l.jsx(L,{}),l.jsx(P,{})]}),l.jsxs("body",{children:[l.jsx(S,{}),l.jsx("h1",{children:"Hello world!"}),l.jsx(E,{}),l.jsx(R,{})]})]})}export{_ as default};
